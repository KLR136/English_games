<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mode Normal - El Beeper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            transition: background-color 0.5s ease;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 600px;
            width: 90%;
        }

        /* √âtat normal */
        .normal-state {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* √âtat r√©ponse */
        .answer-state {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
            animation: flash 0.3s 3;
        }

        @keyframes flash {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .question-display {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 30px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1.4;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 3px solid #e9ecef;
        }

        .status-message {
            font-size: 20px;
            margin: 30px 0;
            min-height: 30px;
            font-weight: bold;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
        }

        .thinking {
            color: #667eea;
        }

        .answer-time {
            color: #00b894;
            font-size: 24px;
        }

        .controls {
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #636e72;
            color: white;
        }

        .btn-music {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            font-size: 14px;
            padding: 8px 15px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .hidden {
            display: none;
        }

        .answers-container {
            margin-top: 30px;
        }

        .answer-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .answer-btn:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }

        .answer-btn.correct {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .answer-btn.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        /* Timer compl√®tement cach√© */
        .hidden-timer {
            display: none;
        }

        .music-controls {
            margin-top: 20px;
        }

        .music-status {
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
    </style>
</head>
<body class="normal-state">
    <div class="game-container">
        <h1>üéÆ Mode Normal</h1>
        
        <div class="question-display" id="questionDisplay">
            La question appara√Ætra ici...
        </div>

        <!-- Timer compl√®tement cach√© -->
        <div class="hidden-timer" id="hiddenTimer">
            <span id="timer">10</span>
        </div>

        <div class="status-message thinking" id="statusMessage">
            ‚è≥ R√©fl√©chissez √† la question...
        </div>

        <div class="answers-container hidden" id="answersContainer">
            <!-- Les r√©ponses seront ajout√©es ici dynamiquement -->
        </div>

        <div class="music-controls">
            <button class="btn btn-music" onclick="toggleMusic()">
                üîá Musique
            </button>
            <div class="music-status" id="musicStatus">
                Musique: Arr√™t√©e
            </div>
        </div>

        <div class="controls">
            <button class="btn btn-primary" onclick="startNewQuestion()">
                Question Suivante
            </button>
            <button class="btn btn-secondary" onclick="goToMenu()">
                Retour au Menu
            </button>
        </div>
    </div>

    <!-- Audio pour le bip -->
    <audio id="bipSound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3" type="audio/mpeg">
    </audio>

    <!-- Musique d'ambiance -->
    <audio id="ambienceMusic" loop preload="auto">
        <source src="https://assets.mixkit.co/music/preview/mixkit-tech-house-vibes-130.mp3" type="audio/mpeg">
        <!-- Musique d'ambiance √©lectronique douce -->
    </audio>

    <script>
        // Variables du jeu
        let currentTimer;
        let timeLeft;
        const thinkingTime = 10; // 10 secondes de r√©flexion
        let questions = [];
        let currentQuestionIndex = 0;
        let isMusicPlaying = false;
        let musicFadeInterval;

        // √âl√©ments DOM
        const questionDisplay = document.getElementById('questionDisplay');
        const timerElement = document.getElementById('timer');
        const statusMessage = document.getElementById('statusMessage');
        const answersContainer = document.getElementById('answersContainer');
        const bipSound = document.getElementById('bipSound');
        const ambienceMusic = document.getElementById('ambienceMusic');
        const body = document.body;
        const musicStatus = document.getElementById('musicStatus');

        // Questions d'exemple
        const sampleQuestions = [
            {
                question: "Quelle est la capitale de la France?",
                answers: [
                    { text: "Londres", correct: false },
                    { text: "Paris", correct: true },
                    { text: "Berlin", correct: false },
                    { text: "Madrid", correct: false }
                ]
            },
            {
                question: "Combien font 2 + 2?",
                answers: [
                    { text: "3", correct: false },
                    { text: "4", correct: true },
                    { text: "5", correct: false },
                    { text: "6", correct: false }
                ]
            },
            {
                question: "Quelle est la couleur du ciel par temps clair?",
                answers: [
                    { text: "Rouge", correct: false },
                    { text: "Vert", correct: false },
                    { text: "Bleu", correct: true },
                    { text: "Jaune", correct: false }
                ]
            }
        ];

        // D√©marrer une nouvelle question
        function startNewQuestion() {
            if (currentQuestionIndex >= sampleQuestions.length) {
                currentQuestionIndex = 0; // Recommencer
            }

            const question = sampleQuestions[currentQuestionIndex];
            currentQuestionIndex++;

            // R√©initialiser l'interface
            questionDisplay.textContent = question.question;
            answersContainer.classList.add('hidden');
            body.className = 'normal-state';
            statusMessage.textContent = "‚è≥ R√©fl√©chissez √† la question...";
            statusMessage.className = 'status-message thinking';

            // D√©marrer la musique d'ambiance si activ√©e
            startAmbienceMusic();

            // D√©marrer le timer cach√©
            startTimer();
        }

        // D√©marrer le timer cach√©
        function startTimer() {
            timeLeft = thinkingTime;
            timerElement.textContent = timeLeft;

            currentTimer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;

                // Fin du temps de r√©flexion
                if (timeLeft <= 0) {
                    clearInterval(currentTimer);
                    timeUp();
                }
            }, 1000);
        }

        // Temps √©coul√©
        function timeUp() {
            // Arr√™ter la musique d'ambiance avec fondu
            stopAmbienceMusic();
            
            // Jouer le bip sonore
            bipSound.play();
            
            // Changer la couleur de fond avec effet flash
            body.className = 'answer-state';
            
            // Afficher le message
            statusMessage.textContent = "üéØ TEMPS √âCOUL√â ! R√©pondez maintenant !";
            statusMessage.className = 'status-message answer-time';

            // Afficher les r√©ponses
            displayAnswers();
        }

        // Gestion de la musique d'ambiance
        function startAmbienceMusic() {
            if (isMusicPlaying) {
                ambienceMusic.currentTime = 0;
                ambienceMusic.volume = 0.3;
                ambienceMusic.play().catch(e => {
                    console.log("Lecture automatique bloqu√©e:", e);
                });
            }
        }

        function stopAmbienceMusic() {
            if (isMusicPlaying) {
                // Fondu de sortie
                fadeOutMusic(ambienceMusic, 500); // 500ms de fondu
            }
        }

        function fadeOutMusic(audioElement, duration) {
            const startVolume = audioElement.volume;
            const fadeStep = startVolume / (duration / 50);
            
            clearInterval(musicFadeInterval);
            
            musicFadeInterval = setInterval(() => {
                if (audioElement.volume > 0) {
                    audioElement.volume = Math.max(0, audioElement.volume - fadeStep);
                } else {
                    clearInterval(musicFadeInterval);
                    audioElement.pause();
                    audioElement.volume = startVolume; // R√©initialiser le volume
                }
            }, 50);
        }

        function toggleMusic() {
            const musicBtn = document.querySelector('.btn-music');
            
            if (isMusicPlaying) {
                // Arr√™ter la musique
                ambienceMusic.pause();
                ambienceMusic.currentTime = 0;
                musicBtn.innerHTML = 'üîá Musique';
                musicStatus.textContent = 'Musique: Arr√™t√©e';
                isMusicPlaying = false;
            } else {
                // D√©marrer la musique
                ambienceMusic.volume = 0.3;
                ambienceMusic.play().then(() => {
                    musicBtn.innerHTML = 'üîä Musique';
                    musicStatus.textContent = 'Musique: En cours...';
                    isMusicPlaying = true;
                }).catch(e => {
                    console.log("Erreur de lecture:", e);
                    musicStatus.textContent = 'Musique: Cliquez pour activer';
                    // Certains navigateurs n√©cessitent une interaction utilisateur
                });
            }
        }

        // Afficher les r√©ponses
        function displayAnswers() {
            const question = sampleQuestions[currentQuestionIndex - 1];
            answersContainer.innerHTML = '';
            answersContainer.classList.remove('hidden');

            question.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.className = 'answer-btn';
                button.textContent = answer.text;
                button.onclick = () => selectAnswer(answer.correct, button);
                answersContainer.appendChild(button);
            });
        }

        // S√©lectionner une r√©ponse
        function selectAnswer(isCorrect, button) {
            // D√©sactiver tous les boutons
            const allButtons = answersContainer.querySelectorAll('.answer-btn');
            allButtons.forEach(btn => {
                btn.disabled = true;
                btn.style.cursor = 'not-allowed';
            });

            // Marquer la r√©ponse correcte/incorrecte
            if (isCorrect) {
                button.classList.add('correct');
                statusMessage.textContent = "‚úÖ Bonne r√©ponse ! üéâ";
            } else {
                button.classList.add('incorrect');
                statusMessage.textContent = "‚ùå Mauvaise r√©ponse !";
                
                // Trouver et marquer la bonne r√©ponse
                const correctButton = Array.from(allButtons).find(btn => 
                    sampleQuestions[currentQuestionIndex - 1].answers[
                        Array.from(allButtons).indexOf(btn)
                    ].correct
                );
                if (correctButton) {
                    correctButton.classList.add('correct');
                }
            }
        }

        // Retour au menu
        function goToMenu() {
            if (confirm("Voulez-vous vraiment retourner au menu ?")) {
                clearInterval(currentTimer);
                stopAmbienceMusic();
                window.location.href = "index.html";
            }
        }

        // D√©marrer la premi√®re question au chargement
        window.onload = function() {
            // Attendre un peu avant de d√©marrer la premi√®re question
            setTimeout(startNewQuestion, 1000);
        };

        // Gestion des erreurs audio
        bipSound.addEventListener('error', function() {
            console.log("Erreur de chargement du bip. Utilisation d'un son de secours.");
            playFallbackBeep();
        });

        ambienceMusic.addEventListener('error', function() {
            console.log("Erreur de chargement de la musique.");
            musicStatus.textContent = 'Musique: Non disponible';
        });

        function playFallbackBeep() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log("L'API Audio n'est pas support√©e");
            }
        }

        // Gestion de la visibilit√© de la page
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Page cach√©e, mettre en pause la musique
                if (!ambienceMusic.paused) {
                    ambienceMusic.pause();
                }
            }
        });
    </script>
</body>
</html>